<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="UTF-8">

    <!-- üî¥ IMPORTANTE PARA CELULAR: SIN ESTO TODO SE VE ‚ÄúENANO‚Äù -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Encuesta EG 2026 - ONPE</title>
    <style>
      :root {
        --onpe-azul: #003366;
        --onpe-azul-claro: #e6ecf7;
      }

      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        max-width: 800px;
        margin: 0 auto;
        line-height: 1.4;
        background-color: #f5f7fb;
      }
      h1 {
        margin-bottom: 5px;
        color: var(--onpe-azul);
        text-align: center;
      }
      h2 {
        margin-bottom: 5px;
      }
      fieldset {
        margin-top: 15px;
        padding: 15px;
        border-radius: 5px;
        border: 1px solid var(--onpe-azul-claro);
        background-color: #ffffff;
      }
      legend {
        font-weight: bold;
        color: var(--onpe-azul);
      }
      label {
        display: block;
        margin-top: 8px;
      }
      .inline-label {
        display: inline-block;
        margin-right: 15px;
      }
      /* Grupo etario en vertical */
      .grupo-etario label {
        display: block;
        margin-top: 4px;
      }
      select,
      input[type="text"],
      button {
        padding: 5px;
        margin-top: 5px;
        min-width: 200px;
      }
      .seccion-oculta {
        display: none;
      }
      .boton {
        margin-top: 20px;
        padding: 10px 18px;
        font-size: 1rem;
        cursor: pointer;
        background-color: var(--onpe-azul);
        color: #ffffff;
        border: none;
        border-radius: 4px;
      }
      .boton:hover {
        opacity: 0.9;
      }
      .mensaje {
        margin-top: 15px;
        font-weight: bold;
        color: var(--onpe-azul);
      }
      .banner {
        max-width: 100%;
        height: auto;
        margin: 10px auto 20px auto;
        display: block;
      }

      /* üì± AJUSTES PARA CELULAR */
      @media (max-width: 600px) {
        body {
          padding: 10px;
          font-size: 15px;
        }

        fieldset {
          padding: 12px;
        }

        /* Inputs y selects a lo ancho */
        select,
        input[type="text"],
        button {
          width: 100%;
          min-width: 0;
          box-sizing: border-box;
        }

        /* Radios en columna para que sea f√°cil tocar */
        .inline-label {
          display: block;
          margin-right: 0;
          margin-top: 6px;
        }

        .grupo-etario label {
          margin-top: 6px;
        }
      }
    </style>
  </head>
  <body>
    <!-- PANTALLA PRINCIPAL (FORMULARIO) -->
    <div id="pantallaFormulario">
      <h1>Encuesta sobre campa√±as - ONPE</h1>

      <!-- Banner opcional -->
      <!--
      <img src="URL_DE_TU_BANNER" alt="Banner ONPE" class="banner">
      -->

      <p>Por favor, responda las siguientes preguntas.</p>

      <!-- ==========================
           DATOS GENERALES
           ========================== -->
      <fieldset>
        <legend>Datos generales</legend>

        <!-- Grupo etario -->
        <label>1. Indique su grupo etario</label>
        <div class="grupo-etario">
          <label>
            <input type="radio" name="grupoEtario" value="18-29"> De 18 a 29 a√±os
          </label>
          <label>
            <input type="radio" name="grupoEtario" value="30-44"> De 30 a 44 a√±os
          </label>
          <label>
            <input type="radio" name="grupoEtario" value="45-59"> De 45 a 59 a√±os
          </label>
          <label>
            <input type="radio" name="grupoEtario" value="60+"> De 60 a m√°s
          </label>
        </div>

        <h2>Lugar de residencia</h2>

        <label for="region">2. Indique su regi√≥n de residencia</label>
        <select id="region">
          <option value="">-- Seleccione regi√≥n --</option>
        </select>

        <label for="provincia">3. Indique su provincia de residencia</label>
        <select id="provincia" disabled>
          <option value="">-- Seleccione provincia --</option>
        </select>

        <label for="distrito">4. Indique su distrito de residencia</label>
        <select id="distrito" disabled>
          <option value="">-- Seleccione distrito --</option>
        </select>

        <!-- El ubigeo se calcula y guarda, pero NO se muestra -->
      </fieldset>

      <!-- ==========================
           PUBLICIDAD ONPE
           ========================== -->
      <fieldset>
        <legend>Sobre la publicidad de la ONPE</legend>

        <!-- Publicidad ONPE -->
        <label>5. ¬øHa visto publicidad de la ONPE sobre las Elecciones Generales?</label>
        <label class="inline-label">
          <input type="radio" name="publicidadONPE" value="S√≠"> S√≠
        </label>
        <label class="inline-label">
          <input type="radio" name="publicidadONPE" value="No"> No
        </label>

        <!-- Medios de publicidad ONPE (solo si responde S√≠) -->
        <div id="seccionMediosPublicidad" class="seccion-oculta">
          <label>6. ¬øA trav√©s de qu√© medios?</label>
          <label>
            <input type="checkbox" name="mediosPublicidadONPE" value="Carteles"> Carteles
          </label>
          <label>
            <input type="checkbox" name="mediosPublicidadONPE" value="Centros comerciales"> Centros comerciales
          </label>
          <label>
            <input type="checkbox" name="mediosPublicidadONPE" value="TV"> TV
          </label>
          <label>
            <input type="checkbox" name="mediosPublicidadONPE" value="Radio"> Radio
          </label>
          <label>
            <input type="checkbox" name="mediosPublicidadONPE" value="Correo electr√≥nico"> Correo electr√≥nico
          </label>
          <label>
            <input type="checkbox" name="mediosPublicidadONPE" value="En persona (espacios p√∫blicos)"> En persona (espacios p√∫blicos)
          </label>
          <label>
            <input type="checkbox" name="mediosPublicidadONPE" value="Redes sociales"> Redes sociales
          </label>
        </div>

        <!-- Claridad de las campa√±as ONPE -->
        <label>
          7. En una escala del 1 al 5, donde 1 es ‚ÄúNada claro‚Äù y 5 es ‚ÄúMuy claro‚Äù,
          ¬øqu√© tan claro le result√≥ el mensaje de las campa√±as publicitarias de la ONPE?
        </label>
        <label class="inline-label">
          <input type="radio" name="claridadONPE" value="1"> 1 ‚Äì Nada claro
        </label>
        <label class="inline-label">
          <input type="radio" name="claridadONPE" value="2"> 2 ‚Äì Poco claro
        </label>
        <label class="inline-label">
          <input type="radio" name="claridadONPE" value="3"> 3 ‚Äì Ni claro ni confuso
        </label>
        <label class="inline-label">
          <input type="radio" name="claridadONPE" value="4"> 4 ‚Äì Algo claro
        </label>
        <label class="inline-label">
          <input type="radio" name="claridadONPE" value="5"> 5 ‚Äì Muy claro
        </label>
      </fieldset>

      <!-- ==========================
           SECCI√ìN ETLV
           ========================== -->
      <fieldset>
        <legend>Sobre el local de votaci√≥n y la plataforma ‚ÄúElige tu Local de Votaci√≥n‚Äù</legend>

        <!-- Sabe que pudo elegir local -->
        <label>8. ¬øSabe que pudo elegir su local de votaci√≥n?</label>
        <label class="inline-label">
          <input type="radio" name="sabePuedeElegirLocal" value="S√≠"> S√≠
        </label>
        <label class="inline-label">
          <input type="radio" name="sabePuedeElegirLocal" value="No"> No
        </label>

        <!-- Supo de la plataforma ETLV -->
        <label>9. ¬øSupo de la plataforma ‚ÄúElige tu Local de Votaci√≥n‚Äù (ETLV)?</label>
        <label class="inline-label">
          <input type="radio" name="supoETLV" value="S√≠"> S√≠
        </label>
        <label class="inline-label">
          <input type="radio" name="supoETLV" value="No"> No
        </label>

        <!-- Bloque ETLV (solo si supoETLV = S√≠) -->
        <div id="seccionETLV" class="seccion-oculta">
          <!-- Ingres√≥ a la plataforma -->
          <label>10. ¬øIngres√≥ a la plataforma ‚ÄúElige tu Local de Votaci√≥n‚Äù?</label>
          <label class="inline-label">
            <input type="radio" name="haAccedidoETLV" value="S√≠"> S√≠
          </label>
          <label class="inline-label">
            <input type="radio" name="haAccedidoETLV" value="No"> No
          </label>

          <!-- Bloque de acceso y problemas (solo si haAccedidoETLV = S√≠) -->
          <div id="seccionAccesoETLV" class="seccion-oculta">
            <!-- Pudo elegir local exitosamente -->
            <label>11. ¬øPudo elegir su local de votaci√≥n exitosamente?</label>
            <label class="inline-label">
              <input type="radio" name="haCambiadoLocal" value="S√≠"> S√≠
            </label>
            <label class="inline-label">
              <input type="radio" name="haCambiadoLocal" value="No"> No
            </label>

            <!-- Problemas con ETLV -->
            <label>12. Al usar la plataforma ‚ÄúElige tu Local de Votaci√≥n‚Äù, ¬øexperiment√≥ alguno de los siguientes problemas? (puede marcar m√°s de una opci√≥n)</label>
            <label>
              <input type="checkbox" name="problemasETLV" value="Problemas para ingresar a la plataforma">
              Problemas para ingresar a la plataforma
            </label>
            <label>
              <input type="checkbox" name="problemasETLV" value="Problemas con las preguntas personales">
              Problemas con las preguntas personales
            </label>
            <label>
              <input type="checkbox" name="problemasETLV" value="Problemas con el reconocimiento facial">
              Problemas con el reconocimiento facial
            </label>
            <label>
              <input type="checkbox" name="problemasETLV" value="Problemas con la toma de foto de DNI">
              Problemas con la toma de foto de DNI
            </label>
            <label>
              <input type="checkbox" name="problemasETLV" value="Problemas con el correo electr√≥nico">
              Problemas con el correo electr√≥nico
            </label>
            <label>
              <input type="checkbox" name="problemasETLV" value="Problemas al ubicar el local de votaci√≥n">
              Problemas al ubicar el local de votaci√≥n
            </label>
            <label>
              <input type="checkbox" name="problemasETLV" value="Bloqueo de cuenta">
              Bloqueo de cuenta
            </label>
            <label>
              <input type="checkbox" name="problemasETLV" value="No tuve problemas">
              No tuve problemas
            </label>
          </div>
        </div>
      </fieldset>

      <!-- BOT√ìN ENVIAR -->
      <button id="btnEnviar" class="boton">Enviar</button>
      <div id="mensaje" class="mensaje"></div>
    </div>

    <!-- PANTALLA DE GRACIAS (DESPU√âS DE ENVIAR) -->
    <div id="pantallaGracias" class="seccion-oculta">
      <h1>Encuesta sobre campa√±as - ONPE</h1>
      <p>
        Se ha realizado el registro correctamente.<br>
        Muchas gracias por su participaci√≥n.
      </p>
    </div>

    <!-- ==========================
         SCRIPT CLIENTE
         ========================== -->
    <script>
      // URL de tu Web App de Apps Script (doPost)
      const API_URL = 'https://script.google.com/macros/s/AKfycbwHIwj1q9hVWQA9nTA5p9BjDb9a7wZRYxeF0D0lAEoQVFvziyfEx49TmuEk8NpbeUDJ_g/exec';

      let distritosActuales = {}; // { "DISTRITO": "UBIGEO", ... }

      window.onload = function() {
        cargarRegiones();
        configurarEventosLogica();
      };

      // ------------------------------
      // UBIGEO: cargar combos
      // ------------------------------
      function cargarRegiones() {
        const regionSelect = document.getElementById('region');
        regionSelect.innerHTML = '<option value="">-- Seleccione regi√≥n --</option>';
    
        fetch(API_URL + '?action=regiones')
          .then(r => r.json())
          .then(regiones => {
            regiones.forEach(region => {
              const opt = document.createElement('option');
              opt.value = region;
              opt.textContent = region;
              regionSelect.appendChild(opt);
            });
          })
          .catch(err => {
            console.error('Error cargando regiones', err);
          });
      }

      function cargarProvincias(region) {
        const provinciaSelect = document.getElementById('provincia');
        const distritoSelect = document.getElementById('distrito');
    
        provinciaSelect.innerHTML = '<option value="">-- Seleccione provincia --</option>';
        distritoSelect.innerHTML = '<option value="">-- Seleccione distrito --</option>';
    
        provinciaSelect.disabled = !region;
        distritoSelect.disabled = true;
    
        if (!region) return;
    
        fetch(API_URL + '?action=provincias&region=' + encodeURIComponent(region))
          .then(r => r.json())
          .then(provincias => {
            provincias.forEach(prov => {
              const opt = document.createElement('option');
              opt.value = prov;
              opt.textContent = prov;
              provinciaSelect.appendChild(opt);
            });
          })
          .catch(err => {
            console.error('Error cargando provincias', err);
          });
      }
    
      function cargarDistritos(region, provincia) {
        const distritoSelect = document.getElementById('distrito');
        distritoSelect.innerHTML = '<option value="">-- Seleccione distrito --</option>';
    
        distritoSelect.disabled = !(region && provincia);
        distritosActuales = {}; // limpiar cach√© local
    
        if (!region || !provincia) return;
    
        fetch(
          API_URL +
            '?action=distritos&region=' +
            encodeURIComponent(region) +
            '&provincia=' +
            encodeURIComponent(provincia)
        )
          .then(r => r.json())
          .then(distritos => {
            distritos.forEach(item => {
              const opt = document.createElement('option');
              opt.value = item.distrito;
              opt.textContent = item.distrito;
              distritoSelect.appendChild(opt);
    
              // guardar ubigeo en cach√© local
              distritosActuales[item.distrito] = item.ubigeo;
            });
          })
          .catch(err => {
            console.error('Error cargando distritos', err);
          });
      }

      // ------------------------------
      // L√ìGICA DE VISIBILIDAD / VALIDACI√ìN
      // ------------------------------
  function configurarEventosLogica() {
    // Regi√≥n ‚Üí Provincia
    document.getElementById('region').addEventListener('change', function() {
      const region = this.value;
      cargarProvincias(region);
    });

    // Provincia ‚Üí Distrito
    document.getElementById('provincia').addEventListener('change', function() {
      const region = document.getElementById('region').value;
      const provincia = this.value;
      cargarDistritos(region, provincia);
    });

        // Publicidad ONPE ‚Üí mostrar / ocultar medios
        const radiosPublicidad = document.getElementsByName('publicidadONPE');
        Array.from(radiosPublicidad).forEach(r => {
          r.addEventListener('change', function() {
            const seccion = document.getElementById('seccionMediosPublicidad');
            if (this.value === 'S√≠') {
              seccion.style.display = 'block';
            } else {
              seccion.style.display = 'none';
              document
                .querySelectorAll('input[name="mediosPublicidadONPE"]:checked')
                .forEach(ch => ch.checked = false);
            }
          });
        });

        // Supo ETLV ‚Üí mostrar / ocultar bloque ETLV
        const radiosSupoETLV = document.getElementsByName('supoETLV');
        Array.from(radiosSupoETLV).forEach(r => {
          r.addEventListener('change', function() {
            const seccion = document.getElementById('seccionETLV');
            const seccionAcceso = document.getElementById('seccionAccesoETLV');
            if (this.value === 'S√≠') {
              seccion.style.display = 'block';
            } else {
              seccion.style.display = 'none';
              seccionAcceso.style.display = 'none';
              document
                .querySelectorAll('input[name="haAccedidoETLV"]:checked, input[name="haCambiadoLocal"]:checked, input[name="problemasETLV"]:checked')
                .forEach(el => el.checked = false);
            }
          });
        });

        // Ha accedido ETLV ‚Üí mostrar / ocultar bloque acceso+problemas
        const radiosHaAccedido = document.getElementsByName('haAccedidoETLV');
        Array.from(radiosHaAccedido).forEach(r => {
          r.addEventListener('change', function() {
            const seccionAcceso = document.getElementById('seccionAccesoETLV');
            if (this.value === 'S√≠') {
              seccionAcceso.style.display = 'block';
            } else {
              seccionAcceso.style.display = 'none';
              document
                .querySelectorAll('input[name="haCambiadoLocal"]:checked, input[name="problemasETLV"]:checked')
                .forEach(el => el.checked = false);
            }
          });
        });

        // Bot√≥n enviar
        document.getElementById('btnEnviar').addEventListener('click', enviarFormulario);
      }

      function obtenerValorRadio(nombre) {
        const seleccionado = document.querySelector(`input[name="${nombre}"]:checked`);
        return seleccionado ? seleccionado.value : '';
      }

      function enviarFormulario() {
        const mensajeDiv = document.getElementById('mensaje');
        mensajeDiv.textContent = '';

        // Lectura de campos b√°sicos
        const grupoEtario = obtenerValorRadio('grupoEtario');
        const region = document.getElementById('region').value;
        const provincia = document.getElementById('provincia').value;
        const distrito = document.getElementById('distrito').value;

        let ubigeo = '-';
        if (distrito && distritosActuales[distrito]) {
          ubigeo = distritosActuales[distrito];
        }

        const publicidadONPE = obtenerValorRadio('publicidadONPE');
        const mediosPublicidadONPE = Array.from(
          document.querySelectorAll('input[name="mediosPublicidadONPE"]:checked')
        ).map(ch => ch.value);

        const claridadONPE = obtenerValorRadio('claridadONPE');
        const sabePuedeElegirLocal = obtenerValorRadio('sabePuedeElegirLocal');
        const supoETLV = obtenerValorRadio('supoETLV');
        const haAccedidoETLV = obtenerValorRadio('haAccedidoETLV');
        const haCambiadoLocal = obtenerValorRadio('haCambiadoLocal');
        const problemasETLV = Array.from(
          document.querySelectorAll('input[name="problemasETLV"]:checked')
        ).map(ch => ch.value);

        // Validaciones b√°sicas (sin cambios)
        if (!grupoEtario) {
          alert('Por favor, indique su grupo etario.');
          return;
        }
        if (!region || !provincia || !distrito || ubigeo === '-') {
          alert('Por favor, complete regi√≥n, provincia y distrito v√°lidos.');
          return;
        }
        if (!publicidadONPE) {
          alert('Por favor, responda la pregunta sobre publicidad de la ONPE (pregunta 5).');
          return;
        }
        if (publicidadONPE === 'S√≠' && mediosPublicidadONPE.length === 0) {
          alert('Por favor, indique a trav√©s de qu√© medios vio la publicidad (pregunta 6).');
          return;
        }
        if (!claridadONPE) {
          alert('Por favor, responda la pregunta sobre claridad de las campa√±as (pregunta 7).');
          return;
        }
        if (!sabePuedeElegirLocal) {
          alert('Por favor, responda la pregunta 8.');
          return;
        }
        if (!supoETLV) {
          alert('Por favor, responda la pregunta 9.');
          return;
        }
        if (supoETLV === 'S√≠' && !haAccedidoETLV) {
          alert('Por favor, responda la pregunta 10 sobre si ingres√≥ a la plataforma.');
          return;
        }
        if (supoETLV === 'S√≠' && haAccedidoETLV === 'S√≠' && !haCambiadoLocal) {
          alert('Por favor, responda la pregunta 11 sobre si pudo elegir su local exitosamente.');
          return;
        }
        if (supoETLV === 'S√≠' && haAccedidoETLV === 'S√≠' && problemasETLV.length === 0) {
          alert('Por favor, indique si tuvo alg√∫n problema al usar la plataforma (pregunta 12).');
          return;
        }

        const formData = {
          grupoEtario,
          region,
          provincia,
          distrito,
          ubigeo,
          publicidadONPE,
          mediosPublicidadONPE,
          claridadONPE,
          sabePuedeElegirLocal,
          supoETLV,
          haAccedidoETLV,
          haCambiadoLocal,
          problemasETLV
        };

        const btn = document.getElementById('btnEnviar');
        btn.disabled = true;
        mensajeDiv.textContent = 'Enviando...';

        // Env√≠o a Apps Script (no-cors para evitar problemas CORS desde HTML externo)
        fetch(API_URL, {
          method: 'POST',
          mode: 'no-cors',
          headers: {
            'Content-Type': 'text/plain;charset=utf-8'
          },
          body: JSON.stringify(formData)
        })
        .then(() => {
          // Cambiar a pantalla de gracias
          document.getElementById('pantallaFormulario').style.display = 'none';
          document.getElementById('pantallaGracias').style.display = 'block';
        })
        .catch(err => {
          console.error(err);
          mensajeDiv.textContent = 'Ocurri√≥ un error al enviar la respuesta. Intente nuevamente.';
          btn.disabled = false;
        });
      }
    </script>
  </body>
</html>
